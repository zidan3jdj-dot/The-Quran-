<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>القرآن الكريم - المصحف الأخضر</title>
    <!-- الخطوط -->
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&display=swap" rel="stylesheet">
    <!-- أيقونات Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Amiri', serif;
            background: #0a3b2e;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" opacity="0.05"><path d="M20 20 L30 10 L40 20 L50 5 L60 20 L70 8 L80 20 L85 15 L90 20 L82 35 L90 50 L80 60 L70 50 L60 70 L50 55 L40 70 L30 55 L20 70 L10 50 L20 35 L10 20 L20 20" fill="none" stroke="%23e6d5a8" stroke-width="1"/><circle cx="50" cy="30" r="2" fill="%23e6d5a8"/><circle cx="30" cy="50" r="2" fill="%23e6d5a8"/><circle cx="70" cy="50" r="2" fill="%23e6d5a8"/></svg>');
            background-repeat: repeat;
            min-height: 100vh;
            padding-bottom: 120px;
            color: #f0ecd9;
            position: relative;
        }

        body::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 59, 46, 0.88);
            z-index: -1;
        }

        header {
            text-align: center;
            padding: 25px 15px;
            font-size: 38px;
            color: #e0cf9b;
            text-shadow: 0 2px 8px rgba(0,0,0,0.3);
            letter-spacing: 1px;
            background: linear-gradient(180deg, #1d5e45, transparent);
            border-bottom: 2px solid #b69b4c;
        }

        header i {
            margin: 0 8px;
            color: #e0cf9b;
        }

        .container {
            max-width: 950px;
            margin: auto;
            padding: 15px;
        }

        /* مربع البحث */
        .search-box {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(4px);
            border: 1px solid #2a6b4e;
            border-radius: 50px;
            padding: 3px 15px;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            box-shadow: 0 5px 15px rgba(0, 20, 0, 0.3);
        }

        .search-box i {
            font-size: 20px;
            color: #b69b4c;
            margin-left: 10px;
        }

        .search-box input {
            background: transparent;
            border: none;
            width: 100%;
            padding: 12px 0;
            font-size: 20px;
            color: #f0ecd9;
            outline: none;
            font-family: 'Amiri', serif;
        }

        .search-box input::placeholder {
            color: #8fa98c;
            opacity: 0.7;
        }

        /* عنوان القائمة */
        .list-header {
            text-align: center;
            margin: 30px 0 20px;
        }

        .list-header h2 {
            font-size: 32px;
            color: #e0cf9b;
            background: rgba(26, 68, 50, 0.6);
            display: inline-block;
            padding: 8px 30px;
            border-radius: 60px;
            border: 1px solid #b69b4c;
            backdrop-filter: blur(4px);
            box-shadow: 0 3px 10px #1a3326;
        }

        /* قائمة السور */
        #surahList {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .surah-card {
            background: rgba(26, 68, 50, 0.6);
            backdrop-filter: blur(4px);
            border: 1px solid #2a6b4e;
            color: #f0e7c0;
            padding: 15px 20px;
            border-radius: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: 0.2s;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            border-bottom: 2px solid #b69b4c;
        }

        .surah-card:hover {
            transform: translateY(-3px);
            background: rgba(36, 94, 70, 0.8);
            border-color: #e0cf9b;
            box-shadow: 0 8px 18px #153f2b;
        }

        .surah-name {
            font-size: 24px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .surah-name i {
            color: #b69b4c;
            font-size: 24px;
        }

        .surah-number {
            background: #2a6b4e;
            color: #e0cf9b;
            min-width: 42px;
            height: 42px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            font-size: 20px;
            font-weight: 600;
            border: 1px solid #b69b4c;
        }

        .surah-meta {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .ayah-count {
            background: #1d4a38;
            color: #e0cf9b;
            padding: 4px 12px;
            border-radius: 25px;
            font-size: 16px;
            border: 1px solid #b69b4c;
        }

        /* رأس القارئ */
        .reader-header {
            background: rgba(26, 68, 50, 0.7);
            backdrop-filter: blur(8px);
            padding: 12px 20px;
            border-radius: 60px;
            border: 1px solid #b69b4c;
            display: flex;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .back, .share-btn {
            background: #2a6b4e;
            border: 1px solid #b69b4c;
            padding: 10px 18px;
            border-radius: 40px;
            color: #f0e7c0;
            cursor: pointer;
            font-size: 20px;
            transition: 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .share-btn {
            background: #1d4a38;
        }

        .back:hover, .share-btn:hover {
            background: #1d5e45;
            transform: translateX(-3px);
        }

        /* القارئ الحالي */
        .current-reciter {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(0, 0, 0, 0.15);
            padding: 6px 16px;
            border-radius: 50px;
            cursor: pointer;
            border: 1px solid #b69b4c;
            transition: 0.2s;
            position: relative;
        }

        .current-reciter:hover {
            background: rgba(0, 0, 0, 0.25);
        }

        .reciter-img {
            width: 42px;
            height: 42px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid #b69b4c;
        }

        .reciter-name {
            font-size: 22px;
            color: #e0cf9b;
        }

        .current-reciter i {
            margin-right: auto;
            color: #b69b4c;
            font-size: 18px;
        }

        /* القائمة المنسدلة للقراء */
        .reciter-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            left: 0;
            margin-top: 8px;
            background: rgba(20, 50, 38, 0.98);
            backdrop-filter: blur(8px);
            border: 1px solid #b69b4c;
            border-radius: 30px;
            padding: 12px;
            z-index: 100;
            display: none;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.4);
        }

        .reciter-dropdown.show {
            display: block;
        }

        .reciter-option {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 16px;
            border-radius: 40px;
            transition: 0.2s;
            cursor: pointer;
            border-bottom: 1px solid #2a6b4e;
        }

        .reciter-option:last-child {
            border-bottom: none;
        }

        .reciter-option:hover {
            background: #2a6b4e;
        }

        .reciter-option img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid #b69b4c;
        }

        .reciter-option span {
            font-size: 20px;
            color: #f0e7c0;
        }

        /* رأس السورة */
        .surah-info {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
            margin: 15px 0 10px;
        }

        .surah-name-big {
            font-size: 36px;
            color: #e0cf9b;
            text-shadow: 0 2px 6px #1a3b2c;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .surah-stats {
            font-size: 20px;
            background: rgba(0, 0, 0, 0.2);
            padding: 4px 16px;
            border-radius: 40px;
            border: 1px solid #b69b4c;
        }

        .font-controls {
            display: flex;
            gap: 8px;
            margin-right: auto;
        }

        .font-controls button {
            background: #2a6b4e;
            border: 1px solid #b69b4c;
            color: #e0cf9b;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 20px;
            cursor: pointer;
            transition: 0.2s;
        }

        .font-controls button:hover {
            background: #1d5e45;
            transform: scale(1.05);
        }

        /* المصحف */
        .mushaf {
            background: #fbf5e0;
            padding: 40px 25px;
            border-radius: 40px 40px 20px 20px;
            line-height: 2.8;
            font-size: var(--font-size-base, 30px);
            text-align: right;
            box-shadow: 0 0 0 5px #2a6b4e, 0 0 0 10px #b69b4c, 0 15px 30px rgba(0, 30, 0, 0.6);
            color: #1e3a2b;
            margin-top: 20px;
            transition: font-size 0.1s;
            position: relative;
        }

        .mushaf::before {
            content: "﴿";
            font-size: 60px;
            color: #2a6b4e;
            position: absolute;
            top: -15px;
            right: 20px;
            opacity: 0.4;
            transform: rotate(8deg);
        }

        .mushaf::after {
            content: "﴾";
            font-size: 60px;
            color: #2a6b4e;
            position: absolute;
            bottom: -15px;
            left: 20px;
            opacity: 0.4;
            transform: rotate(-8deg);
        }

        .bismillah {
            font-size: 42px;
            color: #2a6b4e;
            margin-bottom: 20px;
            font-weight: 600;
            border-bottom: 1px dashed #b69b4c;
            padding-bottom: 10px;
            text-align: center;
        }

        .ayah-wrapper {
            display: inline;
            position: relative;
        }

        .ayah-text {
            display: inline;
            cursor: pointer;
            padding: 4px 4px;
            border-radius: 8px;
            transition: background-color 0.2s;
        }

        .ayah-text:hover {
            background: rgba(42, 107, 78, 0.15);
        }

        .ayah-number-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background-color: #2a6b4e;
            color: #e0cf9b;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            font-size: 14px;
            margin: 0 4px 0 8px;
            border: 1px solid #b69b4c;
            font-weight: bold;
            vertical-align: middle;
        }

        .tafseer-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: transparent;
            border: 1px solid #b69b4c;
            color: #2a6b4e;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            font-size: 12px;
            margin: 0 2px;
            cursor: pointer;
            transition: 0.2s;
            vertical-align: middle;
        }

        .tafseer-btn:hover {
            background: #b69b4c;
            color: #1e3a2b;
        }

        .active {
            background: linear-gradient(145deg, #b69b4c, #2a6b4e);
            color: #fbf5e0 !important;
            box-shadow: 0 0 15px #b69b4c;
            transform: scale(1.01);
            font-weight: 600;
            border-radius: 30px;
            padding: 4px 16px;
        }

        /* نافذة التفسير */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: #fbf5e0;
            color: #1e3a2b;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            border-radius: 40px;
            padding: 30px;
            border: 5px solid #b69b4c;
            box-shadow: 0 0 0 5px #2a6b4e, 0 20px 40px rgba(0, 0, 0, 0.4);
            position: relative;
            text-align: right;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #b69b4c;
            font-size: 24px;
            color: #2a6b4e;
        }

        .modal-close {
            background: #2a6b4e;
            border: 1px solid #b69b4c;
            color: #e0cf9b;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 20px;
            transition: 0.2s;
        }

        .modal-close:hover {
            background: #1d5e45;
            transform: scale(1.05);
        }

        .tafseer-text {
            font-size: 22px;
            line-height: 1.8;
        }

        /* المشغل */
        .player {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 94%;
            max-width: 720px;
            background: rgba(10, 45, 35, 0.98);
            backdrop-filter: blur(12px);
            border: 1px solid #b69b4c;
            border-radius: 80px;
            padding: 12px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            box-shadow: 0 10px 30px #0a251d;
            z-index: 1000;
            transition: 0.3s;
        }

        .player.hidden {
            opacity: 0;
            visibility: hidden;
            transform: translateX(-50%) translateY(20px);
        }

        .player button {
            background: linear-gradient(145deg, #b69b4c, #2a6b4e);
            border: none;
            width: 52px;
            height: 52px;
            border-radius: 50%;
            font-size: 24px;
            cursor: pointer;
            transition: 0.2s;
            color: #1d3b2c;
            box-shadow: 0 4px 0 #1a4a33, 0 6px 12px black;
        }

        .player button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 0 #1a4a33, 0 10px 16px black;
        }

        .player button:active:not(:disabled) {
            transform: translateY(3px);
            box-shadow: 0 2px 0 #1a4a33, 0 8px 12px black;
        }

        .player button:disabled {
            opacity: 0.3;
            box-shadow: 0 2px 0 #1a4a33;
        }

        .progress-area {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .progress-bar {
            flex: 1;
            height: 5px;
            background: #1d4a38;
            border-radius: 10px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            width: 0%;
            background: #b69b4c;
            border-radius: 10px;
        }

        .ayah-counter {
            color: #e0cf9b;
            font-size: 16px;
            min-width: 70px;
            text-align: center;
        }

        /* أزرار مساعدة */
        .go-top {
            position: fixed;
            bottom: 100px;
            left: 20px;
            background: #2a6b4e;
            color: #e0cf9b;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 26px;
            cursor: pointer;
            border: 2px solid #b69b4c;
            box-shadow: 0 4px 12px black;
            transition: 0.2s;
            opacity: 0;
            visibility: hidden;
            z-index: 999;
        }

        .go-top.show {
            opacity: 1;
            visibility: visible;
        }

        .go-top:hover {
            background: #1d5e45;
            transform: scale(1.07);
        }

        .notification {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: #1d4a38;
            color: #e0cf9b;
            padding: 12px 25px;
            border-radius: 50px;
            border: 2px solid #b69b4c;
            font-size: 18px;
            z-index: 2000;
            display: none;
            backdrop-filter: blur(5px);
        }

        .loader, .error {
            text-align: center;
            padding: 30px;
            font-size: 24px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 40px;
            margin: 20px 0;
        }

        .loader {
            color: #e0cf9b;
        }

        .loader i {
            animation: spin 1.5s infinite linear;
            margin-left: 8px;
        }

        .error {
            color: #ffaa7a;
            border: 1px solid #c47a5b;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .islamic-pattern {
            height: 10px;
            background: repeating-linear-gradient(45deg, #b69b4c 0px, #b69b4c 6px, #2a6b4e 6px, #2a6b4e 12px);
            border-radius: 8px;
            margin: 15px 0;
        }

        /* صفحة عنا */
        .about-page {
            min-height: 70vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .about-card {
            background: rgba(26, 68, 50, 0.7);
            backdrop-filter: blur(10px);
            border: 2px solid #b69b4c;
            border-radius: 60px;
            padding: 50px 40px;
            max-width: 700px;
            text-align: center;
            box-shadow: 0 0 0 5px #2a6b4e, 0 0 0 10px #b69b4c, 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        .about-icon {
            font-size: 80px;
            color: #e0cf9b;
            margin-bottom: 20px;
        }

        .about-card h1 {
            font-size: 48px;
            color: #e0cf9b;
            margin-bottom: 30px;
            border-bottom: 2px solid #b69b4c;
            padding-bottom: 15px;
        }

        .about-card p {
            font-size: 28px;
            line-height: 1.8;
            color: #f0e7c0;
            margin-bottom: 40px;
        }

        .about-card .developer {
            font-size: 32px;
            color: #e0cf9b;
            font-weight: bold;
            margin: 30px 0 20px;
        }

        .about-card .dua {
            font-size: 26px;
            background: rgba(0, 0, 0, 0.2);
            padding: 20px;
            border-radius: 50px;
            border: 1px solid #b69b4c;
        }

        .start-btn {
            background: linear-gradient(145deg, #b69b4c, #2a6b4e);
            border: none;
            color: #1d3b2c;
            font-size: 32px;
            padding: 15px 50px;
            border-radius: 80px;
            cursor: pointer;
            font-family: 'Amiri', serif;
            font-weight: bold;
            margin-top: 40px;
            border: 2px solid #e0cf9b;
            box-shadow: 0 6px 0 #1a4a33, 0 10px 20px black;
            transition: 0.2s;
        }

        .start-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 0 #1a4a33, 0 15px 25px black;
        }

        .start-btn:active {
            transform: translateY(3px);
            box-shadow: 0 2px 0 #1a4a33, 0 10px 20px black;
        }

        /* تحسينات الجوال */
        @media (max-width: 600px) {
            header { font-size: 32px; }
            .surah-name { font-size: 20px; }
            .surah-number { min-width: 36px; height: 36px; font-size: 16px; }
            .mushaf { font-size: 24px; padding: 30px 12px; }
            .player button { width: 45px; height: 45px; font-size: 20px; }
            .reciter-name { font-size: 18px; }
            .about-card { padding: 30px 20px; }
            .about-card h1 { font-size: 36px; }
            .about-card p { font-size: 24px; }
        }
    </style>
</head>
<body>
    <header><i class="fas fa-mosque"></i> القرآن الكريم <i class="fas fa-star"></i></header>

    <div class="container">
        <!-- صفحة عنا (تظهر أول مرة) -->
        <div id="aboutPage" class="about-page">
            <div class="about-card">
                <div class="about-icon"><i class="fas fa-quran"></i></div>
                <h1>بسم الله الرحمن الرحيم</h1>
                <p>تم التطوير من قبل</p>
                <div class="developer">محمد زيدان</div>
                <p>قرار أنشأ برنامج للقران الكريم لنشر القران الكريم و اخذ الاجره و الثواب انشاء الله</p>
                <div class="dua">اللهم اجعله في ميزان حسناته</div>
                <button class="start-btn" onclick="startApp()"><i class="fas fa-book-open"></i> افتح المصحف الشريف</button>
            </div>
        </div>

        <!-- الصفحة الرئيسية (تظهر بعد الضغط على بدء) -->
        <div id="home" style="display: none;">
            <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" id="searchInput" placeholder="ابحث عن سورة...">
            </div>
            <div class="list-header"><h2><i class="fas fa-list"></i> فهرس السور</h2></div>
            <div id="surahList"></div>
        </div>

        <!-- صفحة عرض السورة -->
        <div id="reader" style="display: none;">
            <div class="reader-header">
                <button class="back" onclick="goHome()"><i class="fas fa-arrow-right"></i> العودة</button>
                
                <!-- القارئ الحالي مع القائمة المنسدلة -->
                <div class="current-reciter" id="currentReciterBtn" onclick="toggleReciterDropdown()">
                    <img id="currentReciterImg" src="1.jpeg" alt="reciter" class="reciter-img" onerror="this.src='https://via.placeholder.com/42?text=?'">
                    <span id="currentReciterName" class="reciter-name">مشاري العفاسي</span>
                    <i class="fas fa-chevron-down"></i>
                </div>

                <!-- قائمة القراء المخفية -->
                <div id="reciterDropdown" class="reciter-dropdown">
                    <div class="reciter-option" data-value="ar.alafasy" data-img="1.jpeg" onclick="selectReciter('ar.alafasy', 'مشاري العفاسي', '1.jpeg')">
                        <img src="1.jpeg" onerror="this.src='https://via.placeholder.com/40?text=?'">
                        <span>مشاري العفاسي</span>
                    </div>
                    <div class="reciter-option" data-value="ar.abdulbasitmurattal" data-img="2.jpeg" onclick="selectReciter('ar.abdulbasitmurattal', 'عبد الباسط عبد الصمد', '2.jpeg')">
                        <img src="2.jpeg" onerror="this.src='https://via.placeholder.com/40?text=?'">
                        <span>عبد الباسط عبد الصمد</span>
                    </div>
                    <div class="reciter-option" data-value="ar.mahermuaiqly" data-img="3.jpeg" onclick="selectReciter('ar.mahermuaiqly', 'ماهر المعيقلي', '3.jpeg')">
                        <img src="3.jpeg" onerror="this.src='https://via.placeholder.com/40?text=?'">
                        <span>ماهر المعيقلي</span>
                    </div>
                    <div class="reciter-option" data-value="ar.minshawi" data-img="4.jpeg" onclick="selectReciter('ar.minshawi', 'محمد صديق المنشاوي', '4.jpeg')">
                        <img src="4.jpeg" onerror="this.src='https://via.placeholder.com/40?text=?'">
                        <span>محمد صديق المنشاوي</span>
                    </div>
                </div>

                <button class="share-btn" id="shareBtn" onclick="shareSurah()"><i class="fas fa-share-alt"></i> مشاركة</button>
            </div>

            <!-- رأس السورة مع أدوات التحكم -->
            <div class="surah-info">
                <span class="surah-name-big" id="surahName"><i class="fas fa-quran"></i> سورة الفاتحة</span>
                <span class="surah-stats" id="surahStats">7 آيات</span>
                <div class="font-controls">
                    <button onclick="changeFontSize(2)"><i class="fas fa-plus"></i></button>
                    <button onclick="changeFontSize(-2)"><i class="fas fa-minus"></i></button>
                </div>
            </div>

            <div class="islamic-pattern"></div>

            <div class="mushaf" id="ayahContainer" style="font-size: var(--font-size-base);">
                <div class="loader"><i class="fas fa-spinner fa-spin"></i> جاري تحميل السورة...</div>
            </div>
        </div>
    </div>

    <!-- نافذة التفسير المنبثقة -->
    <div class="modal" id="tafseerModal">
        <div class="modal-content">
            <div class="modal-header">
                <span>تفسير الآية</span>
                <div class="modal-close" onclick="closeTafseer()"><i class="fas fa-times"></i></div>
            </div>
            <div class="tafseer-text" id="tafseerText">
                جاري تحميل التفسير...
            </div>
        </div>
    </div>

    <!-- مشغل الصوت -->
    <div class="player" id="player">
        <button onclick="prevAyah()" id="prevBtn" title="الآية السابقة"><i class="fas fa-step-backward"></i></button>
        <button onclick="togglePlay()" id="playPauseBtn" title="تشغيل/إيقاف"><i class="fas fa-play"></i></button>
        <button onclick="nextAyah()" id="nextBtn" title="الآية التالية"><i class="fas fa-step-forward"></i></button>
        <div class="progress-area">
            <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
            <span class="ayah-counter" id="ayahCounter">0/0</span>
        </div>
        <audio id="audio" preload="auto"></audio>
    </div>

    <!-- زر العودة للأعلى -->
    <div class="go-top" id="goTop" onclick="window.scrollTo({top:0,behavior:'smooth'})"><i class="fas fa-arrow-up"></i></div>

    <!-- إشعارات -->
    <div class="notification" id="notification"></div>

    <script>
        // ========== الإعدادات ==========
        const API = "https://api.alquran.cloud/v1";
        const TAFSEER_API = "https://api.quran.com/api/v4"; // API لتفسير السعدي
        let allSurahs = [], ayahs = [], currentIndex = 0, currentSurahNumber = null, isPlaying = false;
        let currentReciter = localStorage.getItem('reciter') || 'ar.alafasy';
        let currentReciterName = localStorage.getItem('reciterName') || 'مشاري العفاسي';
        let currentReciterImg = localStorage.getItem('reciterImg') || '1.jpeg';
        let fontSize = parseInt(localStorage.getItem('fontSize')) || 30;

        // عناصر DOM
        const aboutPage = document.getElementById('aboutPage');
        const homeDiv = document.getElementById('home');
        const readerDiv = document.getElementById('reader');
        const surahListDiv = document.getElementById('surahList');
        const ayahContainer = document.getElementById('ayahContainer');
        const audio = document.getElementById('audio');
        const playerDiv = document.getElementById('player');
        const surahNameSpan = document.getElementById('surahName');
        const surahStats = document.getElementById('surahStats');
        const playPauseBtn = document.getElementById('playPauseBtn');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const searchInput = document.getElementById('searchInput');
        const goTopBtn = document.getElementById('goTop');
        const notification = document.getElementById('notification');
        const ayahCounter = document.getElementById('ayahCounter');
        const progressFill = document.getElementById('progressFill');
        const currentReciterImgEl = document.getElementById('currentReciterImg');
        const currentReciterNameEl = document.getElementById('currentReciterName');
        const reciterDropdown = document.getElementById('reciterDropdown');
        const tafseerModal = document.getElementById('tafseerModal');
        const tafseerText = document.getElementById('tafseerText');

        // تعيين القارئ المحفوظ
        currentReciterImgEl.src = currentReciterImg;
        currentReciterNameEl.textContent = currentReciterName;

        // ========== بدء التطبيق ==========
        function startApp() {
            aboutPage.style.display = 'none';
            homeDiv.style.display = 'block';
            loadSurahs();
        }

        // ========== تحميل السور ==========
        async function loadSurahs() {
            try {
                surahListDiv.innerHTML = '<div class="loader"><i class="fas fa-spinner fa-spin"></i> جاري التحميل...</div>';
                const res = await fetch(`${API}/surah`);
                if (!res.ok) throw new Error('فشل الاتصال');
                const data = await res.json();
                allSurahs = data.data;
                displaySurahs(allSurahs);
                const lastSurah = localStorage.getItem('lastSurah');
                if (lastSurah) {
                    const { number, name } = JSON.parse(lastSurah);
                    setTimeout(() => openSurah(number, name), 500);
                }
            } catch (e) {
                surahListDiv.innerHTML = `<div class="error"><i class="fas fa-exclamation-triangle"></i> ${e.message}</div>`;
            }
        }

        function displaySurahs(surahs) {
            surahListDiv.innerHTML = '';
            if (!surahs.length) {
                surahListDiv.innerHTML = '<div class="error">لا توجد نتائج</div>';
                return;
            }
            surahs.forEach(s => {
                const card = document.createElement('div');
                card.className = 'surah-card';
                card.innerHTML = `
                    <div class="surah-name"><i class="fas fa-quran"></i> ${s.name} (${s.englishName})</div>
                    <div class="surah-meta"><span class="ayah-count">${s.numberOfAyahs} آية</span><span class="surah-number">${s.number}</span></div>
                `;
                card.onclick = () => openSurah(s.number, s.name);
                surahListDiv.appendChild(card);
            });
        }

        // ========== فتح السورة ==========
        async function openSurah(number, name) {
            try {
                localStorage.setItem('lastSurah', JSON.stringify({ number, name }));
                homeDiv.style.display = 'none';
                readerDiv.style.display = 'block';
                surahNameSpan.innerHTML = `<i class="fas fa-quran"></i> سورة ${name}`;
                ayahContainer.innerHTML = '<div class="loader"><i class="fas fa-spinner fa-spin"></i> جاري التحميل...</div>';
                playerDiv.classList.add('hidden');

                const res = await fetch(`${API}/surah/${number}/quran-uthmani`);
                if (!res.ok) throw new Error('فشل التحميل');
                const data = await res.json();
                ayahs = data.data.ayahs;
                currentSurahNumber = number;
                currentIndex = 0;

                surahStats.textContent = `${ayahs.length} آيات`;

                renderAyahs();
                playerDiv.classList.remove('hidden');
                updateButtonsState();
                updateCounter();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            } catch (e) {
                ayahContainer.innerHTML = `<div class="error"><i class="fas fa-exclamation-circle"></i> ${e.message}</div>`;
            }
        }

        function renderAyahs() {
            ayahContainer.innerHTML = '';
            if (currentSurahNumber !== 9) {
                const b = document.createElement('div');
                b.className = 'bismillah';
                b.textContent = 'بِسْمِ اللَّهِ الرَّحْمَٰنِ الرَّحِيمِ';
                ayahContainer.appendChild(b);
            }
            
            ayahs.forEach((a, i) => {
                const wrapper = document.createElement('span');
                wrapper.className = 'ayah-wrapper';
                
                const textSpan = document.createElement('span');
                textSpan.className = 'ayah-text';
                textSpan.id = `ayah-${i}`;
                textSpan.textContent = a.text;
                textSpan.onclick = () => copyAyah(a.text, i);
                
                const numberSpan = document.createElement('span');
                numberSpan.className = 'ayah-number-badge';
                numberSpan.textContent = a.numberInSurah;
                
                const tafseerSpan = document.createElement('span');
                tafseerSpan.className = 'tafseer-btn';
                tafseerSpan.innerHTML = '<i class="fas fa-book-open"></i>';
                tafseerSpan.onclick = (e) => {
                    e.stopPropagation();
                    showTafseer(a.number, i);
                };
                tafseerSpan.title = 'عرض التفسير';
                
                wrapper.appendChild(textSpan);
                wrapper.appendChild(numberSpan);
                wrapper.appendChild(tafseerSpan);
                
                ayahContainer.appendChild(wrapper);
            });
            
            if (ayahs.length) highlightAyah();
        }

        // ========== التفسير ==========
        async function showTafseer(ayahNumber, index) {
            try {
                tafseerText.textContent = 'جاري تحميل التفسير...';
                tafseerModal.classList.add('show');
                
                // استخدام تفسير السعدي (tafsir_id = 7)
                const res = await fetch(`https://api.quran.com/api/v4/quran/tafsirs/7?verse_key=${ayahNumber}`);
                if (!res.ok) throw new Error('فشل تحميل التفسير');
                const data = await res.json();
                
                if (data.tafsirs && data.tafsirs.length > 0) {
                    // إزالة وسوم HTML وتنظيف النص
                    const text = data.tafsirs[0].text.replace(/<[^>]*>/g, '');
                    tafseerText.textContent = text;
                } else {
                    tafseerText.textContent = 'لا يتوفر تفسير لهذه الآية';
                }
            } catch (e) {
                tafseerText.textContent = 'عذراً، حدث خطأ في تحميل التفسير';
                showNotification('فشل تحميل التفسير', true);
            }
        }

        function closeTafseer() {
            tafseerModal.classList.remove('show');
        }

        // إغلاق النافذة بالضغط خارجها
        window.onclick = function(event) {
            if (event.target === tafseerModal) {
                closeTafseer();
            }
        };

        // ========== النسخ والإشعارات ==========
        function copyAyah(text, index) {
            navigator.clipboard.writeText(text).then(() => {
                showNotification('تم نسخ الآية');
                playAyah(index);
            }).catch(() => showNotification('تعذر النسخ', true));
        }

        function showNotification(msg, isError = false) {
            notification.textContent = msg;
            notification.style.backgroundColor = isError ? '#8b3a3a' : '#1d4a38';
            notification.style.display = 'block';
            setTimeout(() => notification.style.display = 'none', 2000);
        }

        // ========== قائمة القراء ==========
        window.toggleReciterDropdown = function() {
            reciterDropdown.classList.toggle('show');
        };

        window.selectReciter = function(value, name, img) {
            currentReciter = value;
            currentReciterName = name;
            currentReciterImg = img;
            localStorage.setItem('reciter', value);
            localStorage.setItem('reciterName', name);
            localStorage.setItem('reciterImg', img);
            currentReciterImgEl.src = img;
            currentReciterNameEl.textContent = name;
            reciterDropdown.classList.remove('show');
            if (!audio.paused) {
                audio.pause();
                playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
                isPlaying = false;
            }
            audio.src = '';
        };

        document.addEventListener('click', function(e) {
            if (!e.target.closest('.current-reciter') && !e.target.closest('.reciter-dropdown')) {
                reciterDropdown.classList.remove('show');
            }
        });

        // ========== مشغل الصوت ==========
        async function playAyah(index) {
            if (index < 0 || index >= ayahs.length) return;
            currentIndex = index;
            highlightAyah();
            try {
                playPauseBtn.innerHTML = '<i class="fas fa-spinner fa-pulse"></i>';
                const ayahNumber = ayahs[index].number;
                const res = await fetch(`${API}/ayah/${ayahNumber}/${currentReciter}`);
                if (!res.ok) throw new Error('فشل تحميل الصوت');
                const data = await res.json();
                audio.src = data.data.audio;
                await audio.play();
                playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
                isPlaying = true;
                audio.onended = () => {
                    if (currentIndex < ayahs.length - 1) {
                        playAyah(currentIndex + 1);
                    } else {
                        playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
                        isPlaying = false;
                    }
                };
            } catch (e) {
                showNotification('تعذر تشغيل الصوت', true);
                playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
                isPlaying = false;
            }
        }

        function highlightAyah() {
            document.querySelectorAll('.ayah-text').forEach(a => a.classList.remove('active'));
            const current = document.getElementById(`ayah-${currentIndex}`);
            if (current) {
                current.classList.add('active');
                current.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
            updateButtonsState();
            updateCounter();
        }

        function updateButtonsState() {
            if (!ayahs.length) {
                prevBtn.disabled = true;
                nextBtn.disabled = true;
                return;
            }
            prevBtn.disabled = currentIndex === 0;
            nextBtn.disabled = currentIndex === ayahs.length - 1;
        }

        function updateCounter() {
            if (ayahs.length) {
                ayahCounter.textContent = `${currentIndex + 1}/${ayahs.length}`;
                progressFill.style.width = `${((currentIndex + 1) / ayahs.length) * 100}%`;
            } else {
                ayahCounter.textContent = '0/0';
                progressFill.style.width = '0%';
            }
        }

        window.togglePlay = function() {
            if (!ayahs.length) return;
            if (audio.paused) {
                if (!audio.src) playAyah(currentIndex);
                else audio.play();
            } else {
                audio.pause();
            }
        };

        window.nextAyah = function() {
            if (currentIndex < ayahs.length - 1) playAyah(currentIndex + 1);
        };

        window.prevAyah = function() {
            if (currentIndex > 0) playAyah(currentIndex - 1);
        };

        audio.addEventListener('play', () => {
            playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
            isPlaying = true;
        });
        audio.addEventListener('pause', () => {
            playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
            isPlaying = false;
        });

        // ========== العودة للرئيسية ==========
        window.goHome = function() {
            homeDiv.style.display = 'block';
            readerDiv.style.display = 'none';
            audio.pause();
            audio.src = '';
            playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
            isPlaying = false;
            playerDiv.classList.add('hidden');
            ayahs = [];
            currentIndex = 0;
        };

        // ========== مشاركة السورة ==========
        window.shareSurah = function() {
            const name = surahNameSpan.innerText.replace('سورة', '').trim();
            if (navigator.share) {
                navigator.share({ title: `سورة ${name}`, text: `أقرأ سورة ${name} من القرآن الكريم`, url: window.location.href });
            } else {
                navigator.clipboard.writeText(window.location.href);
                showNotification('تم نسخ الرابط');
            }
        };

        // ========== تغيير حجم الخط ==========
        window.changeFontSize = function(delta) {
            fontSize = Math.min(48, Math.max(18, fontSize + delta));
            localStorage.setItem('fontSize', fontSize);
            document.documentElement.style.setProperty('--font-size-base', fontSize + 'px');
        };
        document.documentElement.style.setProperty('--font-size-base', fontSize + 'px');

        // ========== البحث مع debounce ==========
        let searchTimeout;
        searchInput.addEventListener('input', () => {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                const q = searchInput.value.trim().toLowerCase();
                if (!q) { displaySurahs(allSurahs); return; }
                const filtered = allSurahs.filter(s => s.name.includes(q) || s.englishName.toLowerCase().includes(q));
                displaySurahs(filtered);
            }, 300);
        });

        // ========== زر العودة للأعلى ==========
        window.addEventListener('scroll', () => {
            goTopBtn.classList.toggle('show', window.scrollY > 300);
        });

        // ========== بدء التطبيق (صفحة عنا تظهر أولاً) ==========
        // نتحقق إذا كان المستخدم يزور التطبيق لأول مرة
        if (!localStorage.getItem('appStarted')) {
            aboutPage.style.display = 'flex';
            homeDiv.style.display = 'none';
            readerDiv.style.display = 'none';
        } else {
            aboutPage.style.display = 'none';
            homeDiv.style.display = 'block';
            loadSurahs();
        }

        window.startApp = function() {
            localStorage.setItem('appStarted', 'true');
            aboutPage.style.display = 'none';
            homeDiv.style.display = 'block';
            loadSurahs();
        };
    </script>
</body>
</html>
